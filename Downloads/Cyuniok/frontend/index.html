<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Case Outcome Predictor</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; background: #0b1220; color: #e5e7eb; }
    .container { max-width: 800px; margin: 0 auto; }
    h1 { font-size: 1.8rem; margin-bottom: 0.5rem; }
    p.desc { color: #9ca3af; margin-top: 0; }
    textarea { width: 100%; min-height: 160px; padding: 12px; border-radius: 8px; border: 1px solid #374151; background: #111827; color: #e5e7eb; }
    button { margin-top: 12px; background: #2563eb; color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; }
    button:disabled { background: #1f2937; cursor: not-allowed; }
    .result { margin-top: 16px; background: #0f172a; border: 1px solid #334155; padding: 12px; border-radius: 8px; }
    .row { display: flex; gap: 12px; align-items: center; margin-bottom: 8px; }
    .row-start { align-items: flex-start; }
    label { min-width: 120px; color: #9ca3af; flex-shrink: 0; }
    .value { font-weight: 600; }
    .reason-box { 
      background: #1e293b; 
      border: 1px solid #475569; 
      border-radius: 6px; 
      padding: 16px; 
      margin-top: 8px;
      white-space: pre-wrap;
      font-family: system-ui, -apple-system, sans-serif;
      line-height: 1.6;
      max-height: 400px;
      overflow-y: auto;
    }
    .prediction-outcome {
      font-size: 1.1em;
      font-weight: bold;
      color: #fbbf24;
      margin: 8px 0;
    }
    footer { margin-top: 2rem; color: #6b7280; font-size: 0.9rem; }
    a { color: #93c5fd; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Case Outcome Predictor</h1>
    <p class="desc">Enter a case summary to predict whether the outcome is plaintiff_wins or defendant_wins.</p>

    <label for="summary">Case summary</label>
    <textarea id="summary" placeholder="Type or paste a case summary..."></textarea>
    <button id="predictBtn">Predict Outcome</button>

    <div id="result" class="result" style="display:none">
      <div class="row"><label>Prediction</label><div class="value" id="predValue">—</div></div>
      <div class="row"><label>Confidence</label><div class="value" id="confValue">—</div></div>
      <div class="row"><label>Top features</label><div class="value" id="featValue">—</div></div>
      <div class="row row-start"><label>Legal Analysis</label><div class="value" style="flex: 1;">
        <div class="reason-box" id="reasonValue">—</div>
      </div></div>
      <div class="row row-start" style="display:none" id="errorRow"><label>Error</label><div class="value" id="errorValue" style="color:#f87171">—</div></div>
    </div>

    <footer>
      Backend must be running at <code>http://127.0.0.1:8000</code>. Try the API at <a href="http://127.0.0.1:8000/docs" target="_blank">/docs</a>.
    </footer>
  </div>

  <script>
    const API_URL = 'http://127.0.0.1:8000/predict';
    const btn = document.getElementById('predictBtn');
    const ta = document.getElementById('summary');
    const result = document.getElementById('result');
  const predValue = document.getElementById('predValue');
  const confValue = document.getElementById('confValue');
  const featValue = document.getElementById('featValue');
  const reasonValue = document.getElementById('reasonValue');
  const errorRow = document.getElementById('errorRow');
  const errorValue = document.getElementById('errorValue');

    function setLoading(isLoading){
      btn.disabled = isLoading;
      btn.textContent = isLoading ? 'Predicting…' : 'Predict Outcome';
    }

    btn.addEventListener('click', async () => {
      const text = (ta.value || '').trim();
      if(!text){
        alert('Please enter a case summary.');
        return;
      }
      setLoading(true);
      try{
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ summary: text })
        });
        let data;
        if(!res.ok){
          let detail = res.status + ' ' + res.statusText;
          try { const errBody = await res.json(); if(errBody && errBody.detail) detail = errBody.detail; } catch(_) {}
          throw new Error(detail);
        } else {
          data = await res.json();
        }
        predValue.textContent = data.prediction ?? '—';
        confValue.textContent = (typeof data.confidence === 'number') ? (data.confidence*100).toFixed(1) + '%' : '—';
        featValue.textContent = (data.top_features && data.top_features.length)
          ? data.top_features.join(', ')
          : 'n/a';
        
        // Format the detailed reasoning properly
        if (data.reason) {
          reasonValue.textContent = data.reason;
          // Add syntax highlighting for better readability
          reasonValue.innerHTML = data.reason
            .replace(/^([A-Z][^:]*:)/gm, '<strong style="color:#fbbf24">$1</strong>')
            .replace(/\n\n/g, '<br><br>')
            .replace(/\n/g, '<br>');
        } else {
          reasonValue.textContent = 'n/a';
        }
        
        errorRow.style.display = 'none';
        result.style.display = 'block';
      }catch(e){
        console.error('Prediction error', e);
        errorValue.textContent = e.message;
        errorRow.style.display = 'flex';
        result.style.display = 'block';
      }finally{
        setLoading(false);
      }
    });
  </script>
</body>
</html>
